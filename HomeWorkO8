using System;
using System.Collections.Generic;

namespace HomeWork_30
{
    class Program
    {
        static void Main(string[] args)
        {
            Arena arena = new Arena();

            arena.AddFighters();
            arena.SelectFighters();
            arena.Fight();
        }

        class Arena
        {
            private List<Fighter> _fighters = new List<Fighter>();
            public Fighter _fighter1 { get; private set; }
            public Fighter _fighter2 { get; private set; }
            public void Fight()
            {
                if (_fighter1 == null || _fighter2 == null)
                    SelectFighters();

                while (_fighter1.Health > 0 && _fighter2.Health > 0)
                {
                    _fighter1.TakeDamage(_fighter2.Damage, _fighter2.IsWeapon);
                    Console.WriteLine($"2 {_fighter1.Health} ХП У {_fighter1.Name}");

                    _fighter2.TakeDamage(_fighter1.Damage, _fighter1.IsWeapon);
                    Console.WriteLine($"1 {_fighter2.Health} ХП У {_fighter2.Name}");

                    _fighter1.UseSpecialAtack();

                    _fighter2.UseSpecialAtack();
                }

                if (_fighter2.Health <= 0)
                    Console.WriteLine("1й крутой");

                if (_fighter1.Health <= 0)
                    Console.WriteLine("2й крутой");

                Console.WriteLine(_fighter1.Health + " " + _fighter2.Health);
            }

            public void SelectFighters()
            {
                ShowFighters();

                Console.WriteLine("1й боец: ");
                if (SelectFighter(out Fighter fighter))
                {
                    _fighter1 = fighter;
                    _fighter1.Number = 1;
                    _fighter1.ShowInfo();
                }

                Console.WriteLine("2й боец: ");
                if (SelectFighter(out Fighter fighter2))
                {
                    _fighter2 = fighter2;
                    _fighter1.Number = 2;
                    _fighter2.ShowInfo();
                }

                Console.ReadKey();
                Console.Clear();
            }

            private bool SelectFighter(out Fighter fighter)
            {
                string id = Console.ReadLine();

                int.TryParse(id, out int inputId);

                if (inputId > 0 && inputId <= _fighters.Count)
                {
                    fighter = _fighters[inputId - 1];
                    return true;
                }
                else
                {
                    fighter = null;
                    return false;
                }
            }

            public void AddFighters()
            {
                _fighters.Add(new Thief("Вор", 600, 50, "Украсть оружие", 10, false, 0));
                _fighters.Add(new Warrior("Воин", 1100, 120, "Блок", 0, true, 0));
                _fighters.Add(new Magician("Маг", 600, 50, "Заморозить", 5, true, 0));
                _fighters.Add(new Nomad("Кочевник", 800, 110, "Оглушить", 1, true, 0));
                _fighters.Add(new Medic("Медик", 900, 50, "Похитить здоровье", 15, false, 0));
            }

            private void ShowFighters()
            {
                for (int i = 0; i < _fighters.Count; i++)
                {
                    Console.Write(i + 1);
                    _fighters[i].ShowInfo();
                }
            }

        }

        class Fighter
        {
            public string Name { get; private set; }
            public int Health { get; protected set; }
            public int Damage { get; protected set; }
            public string SpecialAtackName { get; private set; }
            public int Armor { get; private set; }
            public bool IsWeapon { get; protected set; }
            public int HandDamage { get; protected set; }
            public int Number;

            public Fighter(string name, int health, int damage, string specialAtackName, int armor, bool isWeapon, int number)
            {
                Name = name;
                Health = health;
                Damage = damage;
                SpecialAtackName = specialAtackName;
                Armor = armor;
                IsWeapon = isWeapon;
                HandDamage = 50;
                Number = number;
            }

            public Fighter() { }

            public void TakeDamage(int damage, bool isWeapon)
            {
                if (isWeapon == true)
                    Health -= damage - Armor;
                else
                    Health -= HandDamage - Armor;
            }

            public void ShowInfo()
            {
                Console.WriteLine($"Класс: {Name}   Хп: {Health}   Урон: {Damage}   Броня: {Armor}   Оружие: {IsWeapon}   Навык: {SpecialAtackName}");
            }

            public void TakeWeapon()
            {
                IsWeapon = false;
                Damage = HandDamage;
            }

            public void GiveWeapon(int damage)
            {
                IsWeapon = true;
                Damage +=damage;
            }

            public virtual void UseSpecialAtack() { }
        }

        class Thief : Fighter
        {
            public Thief(string name, int health, int damage, string specialAtackName, int armor, bool isWeapon, int number) : base(name, health, damage, specialAtackName, armor, isWeapon, number) { }

            Random random = new Random();

            public override void UseSpecialAtack()
            {
                int count = 0;
                int maxPercent = 50;
                int randomNumber = random.Next(0, 100);

                if (randomNumber <= maxPercent && randomNumber >= 0)
                {
                    count++;


                        Console.WriteLine("Вор украл оружие");
                }
            }
        }

        class Warrior : Fighter
        {
            public Warrior(string name, int health, int damage, string specialAtackName, int armor, bool isWeapon, int number) : base(name, health, damage, specialAtackName, armor, isWeapon, number) { }
            public Warrior() { } 

            static Random random = new Random();

            public override void UseSpecialAtack()
            {
                int maxPercent = 10;
                int randomNumber = random.Next(0, 100);

                if (randomNumber <= maxPercent && randomNumber >= 0)
                {
                    Console.WriteLine("Воин блокировал удар");
                    Health += HandDamage;
                }
            }
        }

        class Magician : Fighter
        {
            public Magician(string name, int health, int damage, string specialAtackName, int armor, bool isWeapon, int number) : base(name, health, damage, specialAtackName, armor, isWeapon, number) { }

            public override void UseSpecialAtack()
            {

            }
        }

        class Nomad : Fighter
        {
            public Nomad(string name, int health, int damage, string specialAtackName, int armor, bool isWeapon, int number) : base(name, health, damage, specialAtackName, armor, isWeapon, number) { }

            public override void UseSpecialAtack()
            {

            }
        }

        class Medic : Fighter
        {
            public Medic(string name, int health, int damage, string specialAtackName, int armor, bool isWeapon, int number) : base(name, health, damage, specialAtackName, armor, isWeapon, number) { }

            static Random random = new Random();

            public override void UseSpecialAtack()
            {
                int MaxPercent = 10;

                int countStealHealth = random.Next(30, 100);
                int randomNumber = random.Next(0, 100);

                if (randomNumber <= MaxPercent && randomNumber >= 0)
                {
                    Health += countStealHealth;

                    Console.WriteLine($"{Name} поглотил {countStealHealth} здоровья");

                }
            }
        }
    }
}
